<!-- REGISTRO DE VERSIONES -->
<!--
Autor: Efeuno Dev
U.Versi√≥n: 1.0 28/05/2024

<!--------------------------->


<script src="../../public/assets/js/jquery.min.js"></script>
<script src="../../public/assets/js/bootstrap.bundle.min.js"></script>
<script src="../../public/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
<script src="../../public/assets/js/main.js"></script>
<script src="../../public/assets/js/index.js"></script>

<!-- **************************** BlockUI **************************-->

<script src="../../public/assets/js/block-ui/jquery.blockUI.js"></script>
<!-- bootstrap-switch -->
<script src="../../public/js/libs/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>
<!-- DROPZONEJS -->
<script src="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone-min.js"></script>

<!-- **************************** NUEVOS DATATABLES ***************************************************-->
<!-- <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script> -->
<script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="../../public/assets/plugins/datatable/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.jqueryui.min.js"></script>


<!-- <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script> -->
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script> -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script> -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@popperpublic/js/core@2.9.1/dist/umd/popper.min.js"></script>

<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!--Color Picker-->
<script src="../../public/assets/js/color-picker-drawr-palette/dist/jquery.drawrpalette.js" defer></script>

<!-- <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script>
 <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.colVis.min.js"></script>
 <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.html5.min.js"></script> -->

<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.jqueryui.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>

<script src="https://cdn.datatables.net/colreorder/1.6.2/js/dataTables.colReorder.min.js"></script>
<script src="https://cdn.datatables.net/datetime/1.4.1/js/dataTables.dateTime.min.js"></script>
<script src="https://cdn.datatables.net/fixedcolumns/4.2.2/js/dataTables.fixedColumns.min.js"></script>
<script src="https://cdn.datatables.net/fixedheader/3.3.2/js/dataTables.fixedHeader.min.js"></script>
<script src="https://cdn.datatables.net/keytable/2.9.0/js/dataTables.keyTable.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.1/js/responsive.jqueryui.js"></script>

<script src="https://cdn.datatables.net/rowgroup/1.3.1/js/dataTables.rowGroup.min.js"></script>
<script src="https://cdn.datatables.net/rowreorder/1.3.3/js/dataTables.rowReorder.min.js"></script>
<script src="https://cdn.datatables.net/scroller/2.1.1/js/dataTables.scroller.min.js"></script>
<script src="https://cdn.datatables.net/searchbuilder/1.4.2/js/dataTables.searchBuilder.min.js"></script>
<script src="https://cdn.datatables.net/searchbuilder/1.4.2/js/searchBuilder.jqueryui.min.js"></script>
<script src="https://cdn.datatables.net/searchpanes/2.1.2/js/dataTables.searchPanes.min.js"></script>
<script src="https://cdn.datatables.net/searchpanes/2.1.2/js/searchPanes.jqueryui.min.js"></script>
<script src="https://cdn.datatables.net/select/1.6.2/js/dataTables.select.min.js"></script>
<script src="https://cdn.datatables.net/staterestore/1.2.2/js/dataTables.stateRestore.min.js"></script>
<script src="https://cdn.datatables.net/staterestore/1.2.2/js/stateRestore.jqueryui.min.js"></script>


<!-- <script type="text/javascript" src="https://cdn.datatables.net/rowgroup/1.2.0/js/dataTables.rowGroup.min.js"></script> -->
<!-- <script type="text/javascript" src="https://cdn.datatables.net/scroller/2.0.7/js/dataTables.scroller.min.js"></script> -->
<!-- <script type="text/javascript" src="https://cdn.datatables.net/searchbuilder/1.3.4/js/dataTables.searchBuilder.min.js"></script>
 <script type="text/javascript" src="https://cdn.datatables.net/searchbuilder/1.3.4/js/searchBuilder.jqueryui.min.js"></script>
 <script type="text/javascript" src="https://cdn.datatables.net/select/1.4.0/js/dataTables.select.min.js"></script> -->
<!-- ************************************************************************************************* -->

<script src="../../config/templates/comunDataTables.js"></script>
<!-- ************************ SWEETALERT 2 ***************************************************-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- ********************* FONT AWESOME 6.4.0 *********************************** -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" integrity="sha512-fD9DI5bZwQxOi7MhYWnnNPlvXdp/2Pj3XSTRrFs5FQa4mizyGLnJcN6tuvUS6LbmgN1ut+XGSABKvjN0H6Aoow==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- DROPZONEJS -->
<script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>

<!-- TOASTR -->
<script src="../../public/assets/js/toastr/build/toastr.min.js"></script>
<link rel="stylesheet" href="../../public/assets/js/toastr/build/toastr.min.css">

<!-- + - bootstrap -->

<script src="../../public/assets/js/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>


<!-- QR -->
<script type="text/javascript" src="../../public/assets/js/libs/qr-libs/qrcode.js"></script>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/l10n/es.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-minicolors/2.3.6/jquery.minicolors.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>


<!-- Ya no cargar toastr.js de nuevo porque ya est√° cargado arriba -->
<!-- <script src="../../public/assets/js/toastr/toastr.js"></script> -->
<script src="../../public/assets/js/lobibox/lobibox.min.js"></script>

<!-- TORTILLA -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>

<!--FECHAS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>

<script>
    $('#toggle-bs-themeHome').on('click', function() {
        var htmlElement = $('html');
        var themeIcon = $('#theme-icon');

        // Verifica el tema actual
        if (htmlElement.attr('data-bs-theme') === 'dark') {
            // Cambia a modo claro
            htmlElement.attr('data-bs-theme', 'light');
            themeIcon.text('dark_mode');
            localStorage.setItem('theme', 'light'); // Guarda la preferencia
        } else {
            // Cambia a modo oscuro
            htmlElement.attr('data-bs-theme', 'dark');
            themeIcon.text('light_mode');
            localStorage.setItem('theme', 'dark'); // Guarda la preferencia
        }
    });
    //#######################################//
    // FUNCION VALIDAR CAMPO NUMERICO DINERO //
    ///////// PASA LAS COMAS A PUNTOS ////////
    //######################################//
    function comaToPunto(textoComa) {

        var textoPunto = textoComa.replace(',', '.');

        // Actualizar el valor del elemento de entrada (input)
        return textoPunto;
    }
    // Funci√≥n para cifrar en MD5
    function cfrMd(texto) {
        // Utiliza la funci√≥n MD5 de crypto-js
        var hashMD5 = CryptoJS.MD5(texto);
        return hashMD5.toString();
    }
    // Siempre que se necesite poner un hipervinculo de un tel√©fono

    function callTelf(telefono) {
        const hptelefono = '<a class="tx-semibold tx-spacing-2 tx-size-15" href=tel:' + telefono + '>' + telefono + '</a>'
        return hptelefono
    }

    function callEmail(email) {
        const emailMinus = email.toLowerCase();
        var hpemail = '<a class="tx-semibold tx-spacing-2 tx-size-15" href=mailto:' + email + '>' + emailMinus + '</a>'
        console.log(emailMinus);
        return hpemail
    }


    // comprobar si el campo es 0 y no sacar el dato
    function compCero(dato) {
        if (dato == 0 || dato == null) {
            return ""
        } else {
            return dato
        }
    }

    function quitarGuionJS(string) {
        var string = string.split("-").join('');

        return string;
    }


    //########################
</script>
<script src="../../public/assets/js/backdoor.js"></script>


<!-- Summernote JS -->
<script src="../../public/assets/js/libs/summernote/dist/summernote.min.js"></script>
<!-- 

<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-bs5.min.js"></script>
 -->
<!-- Summernote en Espa√±ol -->
<!-- <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/lang/summernote-es-ES.min.js"></script>
 -->
<script>
    //#################################################################################################//
    // Valida cualquier campo que le pases el regEx - Devuelve True si cumple y false si no lo cumple. //
    //#################################################################################################//

    class validarCamposRegex {
        constructor(campo, tipo, min = 5, max = 100) {
            this.campo = campo;
            this.expresion = [
                ///^[a-zA-Z√°√©√≠√≥√∫√±√ë√Å√â√ç√ì√ö√º√ú.,;:¬°!¬ø?"'()\[\]{}<>|&$@%*_+=\s\-\/]+$/gm, //data-type: 0 --> Nombres (Solo Letras, Acentos y Espacios)

                /^[a-zA-Z√°√©√≠√≥√∫√±√ë√Å√â√ç√ì√ö√º√ú.,:;\s\-\/]+$/gm, //data-type: 0 Letras con acentos, espacios, guiones y barras
                /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/, //data-type: 1 Correo electr√≥nico
                /^(?:\+34|0034|34)?(?:6\d{2}|7[1-4]\d)[-\s]?\d{2}[-\s]?\d{2}[-\s]?\d{2}$|^(?:\+34|0034|34)?(?:6\d{2}|7[1-4]\d)[-\s]?\d{3}[-\s]?\d{3}$/, //data-type: 2 Tel√©fono m√≥vil espa√±ol
                /^[a-zA-Z0-9√°√©√≠√≥√∫√±√ë√Å√â√ç√ì√ö√º√ú.,;:¬°!¬ø?"'()\[\]{}<>|&$@%*_+=\s\-\/]+$/gm, //data-type: 3 Letras, n√∫meros, acentos, s√≠mbolos de puntuaci√≥n
                /^(?:\+34|0034|34)?[89]\d{2}[-\s]?\d{2}[-\s]?\d{2}[-\s]?\d{2}$|^(?:\+34|0034|34)?[89]\d{2}[-\s]?\d{3}[-\s]?\d{3}$/, //data-type: 4 Tel√©fono fijo espa√±ol
                /\d+/, //data-type: 5 N√∫meros
                /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{9,}$/gm, //data-type: 6 Contrase√±a segura (may√∫scula, n√∫mero, s√≠mbolo, 9+ caracteres)
                /^\d{8}[A-Z]$/gm, //data-type: 7 DNI espa√±ol
                /^(?:\d{8}[A-Z]|[XYZ]\d{7}[A-Z]|[A-Z]{3}\d{6})$/gm, //data-type: 8 DNI, NIE o CIF espa√±ol
                /^[FMON]$/gm, //data-type: 9 Generos [F: Femenino, M: Masculino, O: Otro, N: No especificado]
                /^\d{4}$/gm, //data-type: 10 A√±o, 1 numero de 4 cifras
                /^(\d{5}(-\d{4})?|[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d|[A-Za-z]{1,2}\d{1,2}[A-Za-z]?\s?\d[A-Za-z]{2}|\d{4}|\d{5})$/gm, //data-type: 11 Codigo postal EEUU, Canada, UK, Alemania, Francia, Australia, Italia, Espa√±a ( dejar espa√±a si funciona mal )( si funciona bien agregar mas paises )
                /^\+?\d{1,3}[-\s]?\d{1,4}[-\s]?\d{1,4}[-\s]?\d{1,9}$/gm, // data-type: 12  numeros internacionales todo tipo de numero +34 612 345 678 +49-89-12345678 +39 06 1234 5678 0034 612345678 612345678
                /^[a-zA-Z0-9√°√©√≠√≥√∫√±√ë√Å√â√ç√ì√ö√º√ú.,;:¬∞¬∫¬™#\-\/\s]+$/gm, // data-type:13 Direcciones Calle Mayor 45, 2¬∫ A - Av. del Libertador, 1234 - 1234/B, Plaza de Espa√±a -C/ Gran V√≠a, n¬∫ 12-B -Calle Falsa 123, Piso 4¬∫, Dpto. B 
                /^\d{5}(-\d{4})?$|^[A-Za-z]\d[A-Za-z] \d[A-Za-z]\d$|^[A-Za-z]\d{4}[A-Za-z]{3}$/gm, // data-type: 14 Codigo Postal Internacional  C√≥digo Postal (Ej. 90210, 90210-1234, K1A 0B1, SW1A 1AA, C1000ABC) 90210 (EEUU) 90210-1234 (EEUU) 28013 (Espa√±a) M1 1AE (Reino Unido) K1A 0B1 (Canad√°) C1000ABC (Argentina)01000-000 (Brasil)



            ][tipo];
            this.min = min;
            this.max = max;
            this.valido = false;
        }

        longitudEnRango(texto) {
            const longitud = texto.length;
            return longitud >= this.min && longitud <= this.max;
        }

        validarRegexAuto() {
            const valor = this.campo.val();
            const validarExpresion = this.expresion.test(valor);
            const validarLongitud = this.longitudEnRango(valor);

            this.valido = validarExpresion && validarLongitud;

            if (this.valido) {
                this.campo.addClass('is-valid');
                this.campo.removeClass('is-invalid');
                $('button[type="submit"]:not(.d-none)').prop("disabled", false);
            } else {
                this.campo.addClass('is-invalid');
                this.campo.removeClass('is-valid');
                $('button[type="submit"]:not(.d-none)').prop("disabled", true);
            }
        }
        validarRegex() {

            const valor = this.campo.val();
            const validarExpresion = this.expresion.test(valor);
            const validarLongitud = this.longitudEnRango(valor);

            this.valido = validarExpresion && validarLongitud;

            if (this.valido) {
                this.campo.addClass('is-valid');
                this.campo.removeClass('is-invalid');
                return true;
            } else {
                this.campo.addClass('is-invalid');
                this.campo.removeClass('is-valid');
                return false;
            }
        }

    }
    //! VALIDACIONES GLOBALES AUTOMATICAS

    // Selecciona todos los elementos con el atributo data-type y agrega un evento click
    $("[data-type]").on("keyup keydown change", function(event) {
        let idEvento = this.getAttribute("id"); // Recoge la ID del elemento en el que est√°s escribiendo
        let tipo = $('#' + idEvento + '').data("type");
        let min = $('#' + idEvento + '').data("min");
        let max = $('#' + idEvento + '').data("max");
        let campo = $('#' + idEvento + '');

        // Convertir a may√∫sculas para tipo "8" (DNI, NIE, CIF)
        if (tipo == "8") {
            campo.val(campo.val().toUpperCase());
        }

        let nombreRex = new validarCamposRegex(campo, tipo, min, max);

        // Validar en tiempo real
        let resultadoNombre = nombreRex.validarRegexAuto();
    });

    // Evento keypress para evitar caracteres no v√°lidos
    /* $("[data-type]").on("keypress", function(event) {
        let idEvento = this.getAttribute("id");
        let tipo = $('#' + idEvento + '').data("type");
        let min = $('#' + idEvento + '').data("min");
        let max = $('#' + idEvento + '').data("max");
        let campo = $('#' + idEvento + '');
        
        let nombreRex = new validarCamposRegex(campo, tipo, min, max);

        // Obtenemos el car√°cter que se est√° escribiendo
        let char = String.fromCharCode(event.which);

        // Verificar si el car√°cter es v√°lido seg√∫n la expresi√≥n regular
        if (!nombreRex.expresion.test(char)) {
            event.preventDefault(); // Evitar que el car√°cter se agregue si no es v√°lido
            console.log("Car√°cter no v√°lido: " + char);
            console.log("Regex: " + nombreRex.expresion);
            console.log("Test: " + nombreRex.expresion.test(char));
        }
    }); */

    $("[data-type]").each(function() {
        if ($(this).data('type') == 6) {
            var $wrapper = $(this).closest('.input-icon');
            var $input = $wrapper.find(".form-control");

            // Crear el √≠cono de ojo y agregarlo al contenedor
            var $eyeIcon = $('<label for="' + $(this).attr("id") + '" title="Mostrar contrase√±a" class="tx-right pd-r-30 eye-icon position-absolute top-50 end-0 translate-middle-y" style="cursor:pointer; right: 10px;"><i class="fa-solid fa-eye"></i></label>');
            $wrapper.append($eyeIcon);

            // A√±adir el evento de clic al √≠cono de ojo
            $eyeIcon.on('click', function() {
                var inputType = $input.attr('type');
                if (inputType === 'password') {
                    $input.attr('type', 'text');
                    $eyeIcon.html('<i class="fa-solid fa-eye-slash"></i>'); // Cambia el √≠cono al hacer clic
                    $eyeIcon.attr("title", "Esconder contrase√±a"); // Cambia el √≠cono al hacer clic
                } else {
                    $input.attr('type', 'password');
                    $eyeIcon.html('<i class="fa-solid fa-eye"></i>'); // Cambia el √≠cono al hacer clic
                    $eyeIcon.attr("title", "Mostrar contrase√±a"); // Cambia el √≠cono al hacer clic
                }
            });
        }
        if ($(this).data("descripcion") == 1) {

            let idEvento = this.getAttribute("id"); //Recoges la ID del elemento en el que estas escribiendo
            let tipoElemento = [
                "Solo letras", //0
                "Correo Electr√≥nico", //1
                "N¬∫ de Tel√©fono m√≥vil ( 6x / 7[1-4]x )", //2
                "Letras y N√∫meros", //3
                "N¬∫ de Tel√©fono Fijo ( 8x / 9x )", //4
                "Solo n√∫meros", //5
                "8 Caracteres, 1 Mayuscula y 1 caracter especial", //6
                "8 N√∫meros y 1 Letra Mayuscula", //7
                "DNI, NIE, NIF", //8
                "[F/M/O/N]", //9
                "A√±o [4 Cifras]", //10
                "Codigo postal", //11
                "N¬∫ Internacional ( Con o sin prefijo )", //12
                "Direcci√≥n", //13
                "C√≥digo Postal Internacional", //14
            ]
            if ($(this).data("new-input") == 1) {

                if ($(this).data("required") == 1) {
                    //$("#" + idEvento).parent().after("<label class='form-control-label w-100'><div class='d-flex justify-content-between'><small class=''>" + tipoElemento[$('#' + idEvento).data("type")] + "<span class='tx-danger fw-bold tx-16'>*</span>" + "</small><small class='contadorPalabras'></small><small class=''> Min: " + $('#' + idEvento).data("min") + " - Max: " + $('#' + idEvento).data("max") + "</small></div></label>");
                    $("#" + idEvento).parent().after("<label class=' mg-l-10 form-control-label tx-10 w-100'>" + tipoElemento[$('#' + idEvento).data("type")] + "<span class='tx-danger fw-bold tx-16'>*</span>" + "</small></label>");

                } else {
                    //$("#" + idEvento).parent().after("<label class='form-control-label w-100'><div class='d-flex justify-content-between'><small class=''>" + tipoElemento[$('#' + idEvento).data("type")] + "</small><small class='contadorPalabras'></small><small class=''> Min: " + $('#' + idEvento).data("min") + " - Max: " + $('#' + idEvento).data("max") + "</small></div></label>");
                    $("#" + idEvento).parent().after("<label class=' mg-l-10 form-control-label tx-10 w-100'>" + tipoElemento[$('#' + idEvento).data("type")] + "</small></label>");


                }
            } else {

                if ($(this).data("required") == 1) {
                    //$("#" + idEvento).after("<label class='form-control-label w-100'><div class='d-flex justify-content-between'><small class=''>" + tipoElemento[$('#' + idEvento).data("type")] + "<span class='tx-danger fw-bold tx-16'>*</span>" + "</small><small class='contadorPalabras'></small><small class=''> Min: " + $('#' + idEvento).data("min") + " - Max: " + $('#' + idEvento).data("max") + "</small></div></label>");
                    $("#" + idEvento).after("<label class=' mg-l-10 form-control-label tx-10 w-100'><small class=''>" + tipoElemento[$('#' + idEvento).data("type")] + "<span class='tx-danger fw-bold tx-16'>*</span>" + "</small></label>");
                } else {
                    //$("#" + idEvento).after("<label class='form-control-label w-100'><div class='d-flex justify-content-between'><small class=''>" + tipoElemento[$('#' + idEvento).data("type")] + "</small><small class='contadorPalabras'></small><small class=''> Min: " + $('#' + idEvento).data("min") + " - Max: " + $('#' + idEvento).data("max") + "</small></div></label>");
                    $("#" + idEvento).after("<label class=' mg-l-10 form-control-label tx-10 w-100'><small class=''>" + tipoElemento[$('#' + idEvento).data("type")] + "</small></label>");

                }
            }
        }
        if ($(this).data("conteo") == 1) {
            let idEvento = this.getAttribute("id"); // Recoge la ID del elemento actual
            let labelElement = $("#" + idEvento).parent().prev(); // Encuentra el <label> correspondiente
            $("#" + idEvento).parent().prev().addClass("col-12 d-flex justify-content-between")
            if (labelElement.length === 0) {
                console.error("No se encontr√≥ un label asociado al elemento con ID:", idEvento);
                return;
            }

            // Asegurarse de que el contador exista dentro del label
            let contadorPalabras = labelElement.find(".contadorPalabras");

            if (contadorPalabras.length === 0) {
                // Si no existe el contador, agregarlo al final del label
                labelElement.append('<label class="contadorPalabras"></label>');
                contadorPalabras = labelElement.find(".contadorPalabras");
            }

            // Actualizar el contenido del contador
            let currentLength = $("#" + idEvento).val().length; // Longitud actual del valor
            let maxLength = $(this).data("max"); // Longitud m√°xima permitida

            if (currentLength > maxLength) {
                // Limitar el valor al m√°ximo permitido
                $("#" + idEvento).val($("#" + idEvento).val().substring(0, maxLength));
                currentLength = maxLength;
            }

            // Actualizar el texto del contador dentro del label
            if (currentLength === 0) {
                contadorPalabras.text(""); // Si no hay caracteres, limpiar el contador
            } else {
                contadorPalabras.text(`Caracteres: ${currentLength}/${maxLength}`);
            }

            // Aplicar o remover la clase de peligro
            if (currentLength >= maxLength) {
                contadorPalabras.addClass("tx-danger");
            } else {
                contadorPalabras.removeClass("tx-danger");
            }
        }

    });

    $("[data-type]").on("input", function() {
        let idEvento = this.getAttribute("id"); //Recoges la ID del elemento en el que estas escribiendo
        if ($("#" + idEvento).val().length >= $(this).data("max")) {
            // Limitar la longitud del valor al m√°ximo permitido
            $("#" + idEvento).val($("#" + idEvento).val().substring(0, $(this).data("max")));
            $("#" + idEvento).parent().prev().find(".contadorPalabras").addClass("tx-danger");
        } else {

            $("#" + idEvento).parent().prev().find(".contadorPalabras").removeClass("tx-danger");
        }

        if ($(this).data("conteo") == 1) {


            if ($(this).data("new-input") == 1) {


                let idEvento = this.getAttribute("id"); //Recoges la ID del elemento en el que estas escribiendo
                $("#" + idEvento).parent().after().find(".contadorPalabras").text("asd");
                if ($("#" + idEvento).val().length == 0) {
                    $("#" + idEvento).parent().prev().find(".contadorPalabras").text("");
                } else {
                    $("#" + idEvento).parent().prev().find(".contadorPalabras").text("Caracteres: " + $("#" + idEvento).val().length + "/" + $(this).data("max"));
                }
            } else {

                let idEvento = this.getAttribute("id"); //Recoges la ID del elemento en el que estas escribiendo
                if ($("#" + idEvento).val().length == 0) {
                    $("#" + idEvento).prev().find(".contadorPalabras").text("");
                } else {
                    $("#" + idEvento).prev().find(".contadorPalabras").text("Caracteres: " + $("#" + idEvento).val().length + "/" + $(this).data("max"));
                }
            }

        }
    });

    function validarCamposVacios() {
        let estanVacios = false; // Inicializamos estanVacios a falso
        console.log($("[data-type]"));
        $("[data-type]").filter(":visible").each(function() {
            if ($(this).data("required") == 1 || $(this).val() != "") {

                let idEvento = this.getAttribute("id");
                console.log("üöÄ ~ $ ~ idEvento:", idEvento)
                //let required = $(this).data("required");
                //console.log(required);

                nombreRex = new validarCamposRegex($('#' + idEvento + ''), $('#' + idEvento + '').data("type"), $('#' + idEvento + '').data("min"), $('#' + idEvento + '').data("max"));
                let resultadoNombre = nombreRex.validarRegex();
                console.log('a');

                console.log(resultadoNombre);
                console.log('b');

                // Si el campo no es requerido (data-required="0") y no pasa la validaci√≥n regex, se marca como error
                if (resultadoNombre == false) {
                    estanVacios = true;
                }
            }

        });

        return estanVacios; // Devolvemos el valor de estanVacios despu√©s de iterar sobre todos los elementos


        /*ORIGINAL
        
          // Selecciona todos los elementos con el atributo data-type y agrega un evento click
            $("[data-type]").filter(":visible").each(function() {
                // Validar movil en tiempo real
                let idEvento = this.getAttribute("id");
                nombreRex = new validarCamposRegex($('#' + idEvento + ''), $('#' + idEvento + '').data("type"), $('#' + idEvento + '').data("min"), $('#' + idEvento + '').data("max"));
                let resultadoNombre = nombreRex.validarRegex();
                if (resultadoNombre == false) {
                    estanVacios = true;
                }
            });
            return estanVacios;
        }
        
        */
    }
    //********************************************/
    //************ VALIDACI√ìN MANUAL *************/
    //********************************************/

    class validarCamposRegexManual {

        constructor(campo, expresion) {
            this.campo = campo;
            this.expresion = expresion;
        }

        validarRegexManual() {
            var valor = this.campo.val();
            var validar = valor.match(this.expresion);

            if (validar == null) {
                this.campo.addClass('is-invalid');
                this.campo.removeClass('is-valid');

                return false;

            } else {
                this.campo.addClass('is-valid');
                this.campo.removeClass('is-invalid');

                return true;
            }
        }

    }


    class validarCamposManual {
        constructor(campo, expresion, infoCampo) {
            this.campo = campo;
            this.expresion = expresion;
            this.infoCampo = infoCampo;
        }

        validar() {
            var valor = this.campo.val();
            var longitud = valor.length;
            var lonMax = this.campo.attr("maxlength");
            var lonMin = this.campo.attr("minlength");
            var validar = valor.match(this.expresion);

            if (longitud < lonMin || longitud > lonMax || (validar == null)) {
                // si hay un problema con alg√∫n valor
                this.campo.removeClass('is-valid');
                this.campo.addClass('is-invalid');

                this.infoCampo.removeClass("tx-gray-500");
                this.infoCampo.addClass("tx-danger");

                this.campo.focus();
                this.campo.select();
                // Boton deshabilitar actualizar en editUsuario
                $('#cambiarPassword').addClass('btn-danger disabled');
                $('#cambiarPassword').attr('disabled', true);

            } else { //si es valido
                this.campo.removeClass('is-invalid');
                this.campo.addClass('is-valid');
                this.infoCampo.addClass("tx-gray-500");
                this.infoCampo.removeClass("tx-danger");


            }
        }
    }

    //********************************************/
    //********************************************/
    //********************************************/
</script>

<!-- ***************************************************** -->
<!-- La funcion com√∫n para  sacar el cartel de los filtros -->
<!-- ***************************************************** -->

<script>
    function actiSumernote(idTabla) {
        var summernote = $('#' + idTabla).summernote({
            placeholder: 'Observaciones',
            tooltip: false,
            tabsize: 2,
            height: 150,
            disablePicture: true, // Deshabilitar la inserci√≥n de im√°genes 
            callbacks: {
                onPaste: function(e) {
                    var clipboardData = e.originalEvent.clipboardData;
                    if (clipboardData && clipboardData.items && clipboardData.items.length) {
                        var item = clipboardData.items[0];
                        if (item.type.indexOf('image') !== -1) {
                            e.preventDefault();
                            toastr["error"]('No se permite pegar im√°genes en este editor.');
                        }
                    }
                }
            },
            lang: 'es-ES', // default: 'en-US' 
            toolbar: [

                ['font', ['bold', 'italic', 'underline', 'clear']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['hr']],
                ['view', ['fullscreen']]
            ]
        }); // end of actiSumernote() 

    } // de la funcion 

    function comprobarEstadoAsistencia() {
        $.ajax({
                url: '../../controller/asistencia.php?op=estado',
                method: 'POST',
                dataType: 'json',
            })
            .done(function(data) {
                console.log(data)
                if (data == 0) {
                    // Si la fecha es nula, ocultar bot√≥n de inicio y mostrar bot√≥n de finalizaci√≥n
                    $('#asistenciaLink').addClass('d-none');
                    $('#finalizarLink').removeClass('d-none');
                } else if (data == 2) {
                    // Si no existe el id, habilitamos el boton de iniciar asistencia y desabilitar el de finalizar
                    $('#asistenciaLink').removeClass('d-none');
                    $('#finalizarLink').addClass('d-none');
                } else {
                    // Si hay una fecha, mostrar bot√≥n de inicio y ocultar bot√≥n de finalizaci√≥n
                    $('#asistenciaLink').removeClass('d-none');
                    $('#finalizarLink').addClass('d-none');
                }
            })
            .fail(function(jqXHR, textStatus, errorThrown) {
                console.error('Error:', errorThrown);
            });
    }
    comprobarEstadoAsistencia();
    $(function() {

        $.fn.raty.defaults.path = '../../public/js/images/rating/';

        // Read Only
        $('#read-only-stars').raty({
            readOnly: true,
            score: 3
        });
    });
    // FUNCION PREPARADA PARA PRESENTAR EL CARTEL DE FILTRO ACTIVO
    function controlarFiltros(nomDataTable) {

        $(".dtsb-title").addClass("badge bg-info tx-20");
        $(".dtsb-titleRow").next().find(".btn-outline-danger").removeClass("btn-outline-danger").addClass("btn-outline-info");
        var tabla = $("#" + nomDataTable).DataTable();
        var valorfiltro = 0;

        var palabras = ["(1)", "(2)", "(3)", "(4)", "(5)", "(6)", "(7)", "(8)", "(9)"];
        var palabraEncontrada = false;
        for (var i = 0; i < palabras.length; i++) {
            if ($('.dtsb-titleRow').text().includes(palabras[i])) {
                valorfiltro = 1;
                palabraEncontrada = true;
                break;
            }
        }

        if (valorfiltro == 1) {

            $('.filtro-activo').removeClass('d-none');
        }

        if (tabla.state.loaded()) {
            var filters = tabla.state().columns;
            if (valorfiltro == 0) {
                for (var i = 0; i < filters.length; i++) {
                    if (filters[i].search.search != "") {
                        //                console.log("Columna " + i + " tiene filtro " + filters[i].search.search);
                        $('.filtro-activo').removeClass('d-none');
                        valorfiltro = 1;
                        break;
                    } else {
                        //              console.log("Sin filtro activo");
                        $('.filtro-activo').addClass('d-none');
                        valorfiltro = 0;
                    }
                } // del for    
            } // del if valorfiltro==
        } // del if documentos_table.state.loaded()


        // vamos a comprobar el campo search a ver si est√° cumplimentado

        var dataTable = $("#" + nomDataTable).DataTable();

        // var dataTable = $("#idiomas_table").DataTable();
        var buscar = dataTable.search();
        if (buscar.length > 0) {
            if (valorfiltro == 0) {
                $('.filtro-activo').removeClass('d-none');
            }
        } // de la longitud
    } // de la funcion
    /************************************/


    // FINAL DE LA FUNCION DE PRESENTAR EL CARTEL DE FILTRO ACTIVO





    //=============================================\\
    //              CARGA               \\
    //==============================================//
    // onBlock callback
    function cargando() {

        $.blockUI({
            message: '<i class=""><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-circle-key" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M21 12a9 9 0 1 1 -18 0a9 9 0 0 1 18 0z" /><path d="M12.5 11.5l-4 4l1.5 1.5" /><path d="M12 15l-1.5 -1.5" /></svg></i>',
            fadeIn: 1000,
            //timeout: 2000, //unblock after 2 seconds
            overlayCSS: {
                backgroundColor: '#000',
                opacity: 0.5,
                cursor: 'wait',
                zIndex: 9999 // Ajusta el z-index para que est√© por encima del modal

            },
            css: {
                border: 0,
                padding: 0,
                color: '#333',
                backgroundColor: 'transparent'
            },
        });
    }

    // onUnblock callback
    function descargando() {
        $.blockUI({
            message: '<i class=""><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-circle-key" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M21 12a9 9 0 1 1 -18 0a9 9 0 0 1 18 0z" /><path d="M12.5 11.5l-4 4l1.5 1.5" /><path d="M12 15l-1.5 -1.5" /></svg></i>',
            timeout: 1000, //unblock after 2 seconds
            overlayCSS: {
                backgroundColor: '#000',
                opacity: 0.5,
                cursor: 'wait',
                zIndex: 9999 // Ajusta el z-index para que est√© por encima del modal

            },
            css: {
                border: 0,
                padding: 0,
                color: '#333',
                backgroundColor: 'transparent'
            },
            onUnblock: function() {}
        });
    }




    $(".date-format").flatpickr({
        altInput: true,
        altFormat: "j F, Y",
        dateFormat: "Y-m-d",
        locale: "es" // Configuraci√≥n para espa√±ol
    });


    function calcularColores() {
        $(".calcularColor").each(function() {
            console.log("entra");
            let bgColor = $(this).css("background-color");

            let isDark = isColorDark(bgColor); // TRUE SI EL COLOR ES OSCURO FALSE SI ES CLASE

            if (isDark) {
                colorLetra = "white";
            } else {
                colorLetra = "black";
            }
            $(this).css("color", colorLetra);
        });
    }

    function limpiarModalInputs() {
        $(".modal").find("input").each(function() {
            $(this).val("");
            $(this).removeClass("is-valid");
            $(this).removeClass("is-invalid");
        });
        $(".modal").find("textarea").each(function() {
            $(this).val("");
            $(this).removeClass("is-valid");
            $(this).removeClass("is-invalid");
        });
    }

    function limpiarModalValidaciones() {
        $(".modal").find("input").each(function() {
            $(this).removeClass("is-valid");
            $(this).removeClass("is-invalid");
        });
    }
    $('.select2-with-menu-bg').each(function(i, obj) {
        var variation = "",
            textVariation = "",
            textColor = "";
        var color = $(this).data('bgcolor');
        variation = $(this).data('bgcolor-variation');
        textVariation = $(this).data('text-variation');
        textColor = $(this).data('text-color');
        if (variation !== "") {
            variation = " bg-" + variation;
        }
        if (textVariation !== "") {
            textVariation = " " + textVariation;
        }
        var className = "bg-" + color + variation + " " + textColor + textVariation + " border-" + color;

        $(this).select2({
            dropdownCssClass: className
        });
    });

    function formatState(state) {
        if (!state.id) {
            return state.text;
        }
        var $state = $(
            '<span class="badge tx-16-force" style="background-color:' + $(state.element).data('color') + '">' + state.text + '</span>'
        );
        return $state;
    }

    function validarArrayVacio(array) {
        if (array.length === 0) {
            return true;
        }
    }


    // Funci√≥n para formatear la fecha en formato europeo (d√≠a/mes/a√±o) con hora
    function formatearFechaEuropea(fecha) {
        let date = new Date(fecha.replace(' ', 'T')); // Reemplazar espacio con 'T' para formato ISO
        let dia = date.getDate();
        let mes = date.getMonth() + 1; // Los meses en JavaScript son 0-11
        let a√±o = date.getFullYear();
        let horas = date.getHours();
        let minutos = date.getMinutes();
        let segundos = date.getSeconds();

        // Agregar ceros a d√≠a, mes, horas, minutos y segundos si son menores de 10
        if (dia < 10) dia = '0' + dia;
        if (mes < 10) mes = '0' + mes;
        if (horas < 10) horas = '0' + horas;
        if (minutos < 10) minutos = '0' + minutos;
        if (segundos < 10) segundos = '0' + segundos;

        return dia + '-' + mes + '-' + a√±o + ' ' + horas + ':' + minutos + ':' + segundos;

    }

    function convertirFechaEuropea(fecha) {
        let partes = fecha.split("-");
        return `${partes[2]}-${partes[1]}-${partes[0]}`;
    }


    // FUNCION PARA TICKETS
    function convertirFormatoFechaHora(fecha) {
        const fechaPartido = fecha.split(' ');

        const partesFecha = fechaPartido[0].split('-');
        const partesHoras = fechaPartido[1].split(':');

        const dia = partesFecha[2];
        const mes = partesFecha[1];
        const a√±o = partesFecha[0];

        const hora = partesHoras[0];
        const min = partesHoras[1];
        const sec = partesHoras[2];

        return `${dia}-${mes}-${a√±o} ${hora}:${min} `;
    }
    // Enfocar el campo de b√∫squeda autom√°ticamente al abrir el dropdown
    $('.select2').on('select2:open', function() {
        // Asegurar que el campo de b√∫squeda est√° visible
        let searchField = document.querySelector('.select2-search__field');
        if (searchField) {
            searchField.style.display = 'block'; // Garantizar que sea visible
            searchField.focus(); // Enfocar el campo de b√∫squeda
        }
    });
</script>

<script>
    console.log('%c Desarrollado por: \n EFEUNO DEV S.L', 'color: green; font-size: 35px; font-weight: bold;');
</script>

<script>
    // CONTROL DE SESION DEPENDIENDO DEL IDUSUARIO. ESTO PERMITE NO VER LA PAGINA WEB A GENTE NO AUTORIZADA. 
    //ROL 1 ESTARA AUTORIZADO, ROL 0, AUTORIZADO, PERO DEPENDE DE LA ID DE LA ORDEN TRANSPORTE
    function comprobarAcceso() {
        $.post("../../controller/transportes.php?op=comprobarAccesoTransporte", function(data) { //Ejemplo : $.post("../../controller/usuario.php?op=listarID",{id:id},function (data) {})
            console.log(data);
        })
    }
</script>

<script>
    //! PLUGIN PARA DATATABLES !//

    //* { targets: [4], type: "date-eu" } AL PONER type: "date-eu", claramente el target 4 tiene que ser fechas, ordenara las fechas segun las europes y no llas americanas
    /*
    jQuery.extend(jQuery.fn.dataTableExt.oSort, {
        "date-eu-pre": function(a) {
            if (a == null || a === "") {
                return 0;
            }

            // Separar fecha y hora (dd-mm-yyyy hh:mm)
            var eu_date_and_time = a.split(' ');
            var eu_date = eu_date_and_time[0].split('-');
            var eu_time = eu_date_and_time[1] ? eu_date_and_time[1].split(':') : [0, 0];

            // Convertir fecha y hora a formato num√©rico YYYYMMDDHHMM
            return (eu_date[2] + eu_date[1] + eu_date[0] + eu_time[0] + eu_time[1]) * 1;
        },
        "date-eu-asc": function(a, b) {
            return a - b;
        },
        "date-eu-desc": function(a, b) {
            return b - a;
        }

        // Separar fecha y hora (dd-mm-yyyy hh:mm)
        var eu_date_and_time = a.split(' ');
        var eu_date = eu_date_and_time[0].split('-');
        var eu_time = eu_date_and_time[1] ? eu_date_and_time[1].split(':') : [0, 0];

        // Convertir fecha y hora a formato num√©rico YYYYMMDDHHMM
        return (eu_date[2] + eu_date[1] + eu_date[0] + eu_time[0] + eu_time[1]) * 1;
    },
    "date-eu-asc": function(a, b) {
        return a - b;
    },
    "date-eu-desc": function(a, b) {
        return b - a;
    }
    });
    */
     ///////////////////////////////////////////
    // AQUI PARECE QUE HAY ALGO MAL CERRADO!!
    ///////////////////////////////////////////

    //! PLUGIN PARA DATATABLES !//

//* { targets: [4], type: "date-eu" } AL PONER type: "date-eu", claramente el target 4 tiene que ser fechas, ordenara las fechas segun las europeas y no las americanas
jQuery.extend(jQuery.fn.dataTableExt.oSort, {
    "date-eu-pre": function(a) {
        if (a == null || a === "") {
            return 0;
        }

        // Separar fecha y hora (dd-mm-yyyy hh:mm)
        var eu_date_and_time = a.split(' ');
        var eu_date = eu_date_and_time[0].split('-');
        var eu_time = eu_date_and_time[1] ? eu_date_and_time[1].split(':') : [0, 0];

        // Convertir fecha y hora a formato num√©rico YYYYMMDDHHMM
        return (eu_date[2] + eu_date[1] + eu_date[0] + eu_time[0] + eu_time[1]) * 1;
    },
    "date-eu-asc": function(a, b) {
        return a - b;
    },
    "date-eu-desc": function(a, b) {
        return b - a;
    }
});

///////////////////////////////////////////
// AQUI YA EST√Å BIEN CERRADO Y SIN ERRORES //
///////////////////////////////////////////
  
</script>
<script>
    /* Cambiar de modal */

    function guardarYMostrarHora() {
        var descripcion = $("#descripcionOtros").val();
        var data = {
            descripcion: descripcion
        };
        $.ajax({
            url: '../../controller/asistencia.php?op=inicioAsistencia',
            method: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: data,
            success: function(response) {
                comprobarEstadoAsistencia();
            },
            error: function(error) {
                // Aqu√≠ puedes manejar el caso de una respuesta no exitosa
                console.log('Error al enviar los datos');
            }

        });
        // Vaciar el campo de texto
        $("#descripcionOtros").val("");

        var ahora = new Date();
        var hora = ahora.getHours();
        var minutos = ahora.getMinutes();
        var segundos = ahora.getSeconds();
        var horaActual = hora + ":" + minutos + ":" + segundos;

        $("#horaActual").text("Entrada registrada a las: " + horaActual);
        $("#modalOtros").modal("hide");
        $("#modalOK").modal("show");
    }

    function guardarYMostrarHoraFinalizar() {
        var ahora = new Date();
        var hora = ahora.getHours();
        var minutos = ahora.getMinutes();
        var segundos = ahora.getSeconds();
        var horaActual = hora + ":" + minutos + ":" + segundos;

        $("#horactualFinalizar").append(" " + horaActual);


        fetch('../../controller/asistencia.php?op=finAsistencia', {
                method: 'POST'
            })
            .then(response => response.text())
            .then(data => {
                // Realizar alguna acci√≥n con la respuesta del servidor
                comprobarEstadoAsistencia();
            })
            .catch(error => {
                console.error('Error:', error);
            });

    }

    function convertirHorasAMinutos(horaStr) {
        if (!horaStr) return 0;
        const partes = horaStr.split(':');
        const horas = parseInt(partes[0]) || 0;
        const minutos = parseInt(partes[1]) || 0;
        const segundos = parseInt(partes[2]) || 0;

        return (horas * 60) + minutos + Math.floor(segundos / 60);
    }

    function comprobarEstadoAsistencia() {
        $.ajax({
                url: '../../controller/asistencia.php?op=estado',
                method: 'POST',
                dataType: 'json',
            })
            .done(function(data) {
                console.log(data)
                if (data == 0) {
                    // Si la fecha es nula, ocultar bot√≥n de inicio y mostrar bot√≥n de finalizaci√≥n
                    $('#asistenciaLink').addClass('d-none');
                    $('#finalizarLink').removeClass('d-none');
                } else if (data == 2) {
                    // Si no existe el id, habilitamos el boton de iniciar asistencia y desabilitar el de finalizar
                    $('#asistenciaLink').removeClass('d-none');
                    $('#finalizarLink').addClass('d-none');
                } else {
                    // Si hay una fecha, mostrar bot√≥n de inicio y ocultar bot√≥n de finalizaci√≥n
                    $('#asistenciaLink').removeClass('d-none');
                    $('#finalizarLink').addClass('d-none');
                }
            })
            .fail(function(jqXHR, textStatus, errorThrown) {
                console.error('Error:', errorThrown);
            });
    }
    comprobarEstadoAsistencia();
    $(function() {

        $.fn.raty.defaults.path = '../../public/js/images/rating/';

        // Read Only
        $('#read-only-stars').raty({
            readOnly: true,
            score: 3
        });
    });


    // FECHAS
    flatpickr(".fechaFullpick", {
  enableTime: true,
  dateFormat: "d/m/Y H:i", // formato europeo
  locale: "es",
  allowInput: true,
  time_24hr: true,
  onClose: function(selectedDates, dateStr, instance) {
    if (selectedDates.length > 0) {
      const fecha = selectedDates[0];
      const anio = fecha.getFullYear();

      // Validaci√≥n de a√±o
      // Validaci√≥n de a√±o entre 1910 y 2040
      if (anio < 1910) {
        setTimeout(() => {
           toastr.error("‚ùå El a√±o no puede ser anterior a 1910");
        }, 10);
        instance.clear();
        return;
      }

      if (anio > 2040) {
        setTimeout(() => {
          toastr.error("‚ùå El a√±o no puede ser posterior a 2040");
        }, 10);
        instance.clear();
        return;
      }

      // Esperar un poco y mostrar d√≠a de la semana
      setTimeout(() => {
        const dias = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
        const diaSemana = dias[fecha.getDay()];
        instance.input.value = `${diaSemana}, ${dateStr}`;
      }, 50);
    }
  }
});
    flatpickr(".fechaFullHoypick", {
  enableTime: true,
  dateFormat: "d/m/Y H:i", // formato europeo
  locale: "es",
  allowInput: true,
  time_24hr: true,
  minDate: "today", // ‚¨ÖÔ∏è NO permitir fechas anteriores a hoy

  onClose: function(selectedDates, dateStr, instance) {
    if (selectedDates.length > 0) {
      const fecha = selectedDates[0];
      const anio = fecha.getFullYear();

      // Validaci√≥n de a√±o
      // Validaci√≥n de a√±o entre 1910 y 2040
      if (anio < 1910) {
        setTimeout(() => {
           toastr.error("‚ùå El a√±o no puede ser anterior a 1910");
        }, 10);
        instance.clear();
        return;
      }

      if (anio > 2040) {
        setTimeout(() => {
          toastr.error("‚ùå El a√±o no puede ser posterior a 2040");
        }, 10);
        instance.clear();
        return;
      }

      // Esperar un poco y mostrar d√≠a de la semana
      setTimeout(() => {
        const dias = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
        const diaSemana = dias[fecha.getDay()];
        instance.input.value = `${diaSemana}, ${dateStr}`;
      }, 50);
    }
  }
});

    flatpickr(".fechaSinHorapick", {
    dateFormat: "d/m/Y", // formato europeo
    locale: "es",
    allowInput: true,
    
    onClose: function(selectedDates, dateStr, instance) {
        if (selectedDates.length > 0) {
        const fecha = selectedDates[0];
        const anio = fecha.getFullYear();

        // Validaci√≥n de a√±o
        // Validaci√≥n de a√±o entre 1910 y 2040
        if (anio < 1910) {
            setTimeout(() => {
            toastr.error("‚ùå El a√±o no puede ser anterior a 1910");
            }, 10);
            instance.clear();
            return;
        }

        if (anio > 2040) {
            setTimeout(() => {
            toastr.error("‚ùå El a√±o no puede ser posterior a 2040");
            }, 10);
            instance.clear();
            return;
        }

      
        }
    }
    });
    flatpickr(".fechaSinHoraHoypick", {
    dateFormat: "d/m/Y", // formato europeo
    locale: "es",
    allowInput: true,
    minDate: "today", // ‚¨ÖÔ∏è NO permitir fechas anteriores a hoy

    onClose: function(selectedDates, dateStr, instance) {
        if (selectedDates.length > 0) {
        const fecha = selectedDates[0];
        const anio = fecha.getFullYear();

        // Validaci√≥n de a√±o
        // Validaci√≥n de a√±o entre 1910 y 2040
        if (anio < 1910) {
            setTimeout(() => {
            toastr.error("‚ùå El a√±o no puede ser anterior a 1910");
            }, 10);
            instance.clear();
            return;
        }

        if (anio > 2040) {
            setTimeout(() => {
            toastr.error("‚ùå El a√±o no puede ser posterior a 2040");
            }, 10);
            instance.clear();
            return;
        }

      
        }
    }
    });

   function formatearFechaConHora(fechaStr) {
    if (!fechaStr || typeof fechaStr !== "string") return null;
    try {
        const partes = fechaStr.includes(",") ? fechaStr.split(",")[1].trim() : fechaStr.trim();
        const [fecha, hora = "00:00"] = partes.split(" ");
        const [dia, mes, anio] = fecha.split("/");
        if (!dia || !mes || !anio) return null;
        return `${anio}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')} ${hora}:00`;
    } catch {
        return null;
    }
}

function formatearFechaSinHora(fechaStr) {
    if (!fechaStr || typeof fechaStr !== "string") return null;
    try {
        const [dia, mes, anio] = fechaStr.split("/");
        if (!dia || !mes || !anio) return null;
        return `${anio}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;
    } catch {
        return null;
    }
}

          
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>